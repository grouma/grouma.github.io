<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      IoT Remote &middot; Gary Roumanis
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="/public/css/custom.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-52592813-1', 'auto');
  ga('send', 'pageview');

</script>


  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">

  <div class="sidebar-item">
    <div class="sidebar-logo">
      <img src="/public/images/me.jpg" alt="me"/>
    </div>
  </div>

  <div class="sidebar-item">
    <p>Gary Roumanis -</br>Software Development Engineer, Microsoft.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
   
    <a class="sidebar-nav-item" href="/public/resume.pdf">Resume</a>
  </nav>

  <div class="sidebar-item">
    <center><a href="mailto:me@garyroumanis.com">Email</a> Â· <a href="https://www.linkedin.com/in/garyroumanis">LinkedIn</a></center>
  </div>

</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Gary Roumanis</a>
            <small>Personal Webpage</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">IoT Remote</h1>
  <span class="post-date">15 Mar 2015</span>
  <p>I don&#39;t subscribe to cable and get most of my video content from Netflix, Hulu and YouTube which is consumed through an Apple TV or Chromecast. This means I can mostly control my TV from my phone, which is always by my side. Unfortunately, changing the input, volume or powering on my TV means I have to use the provided remote. This is a massive pain because I&#39;m constantly losing the device. I end up tearing my living room apart to often find it left in the bathroom or some other random location. After the umpteenth time I decided I was going to do something about it. The solution I came up with was a simple iOS application paired with an Internet connected micro-controller.</p>

<h3>Materials</h3>

<ul>
<li><a href="https://www.spark.io/">Spark Core</a></li>
<li><a href="https://www.sparkfun.com/products/10732/">IR Led Kit</a></li>
<li>Breadboard and various hookup wires</li>
<li>iOS device</li>
<li>Basic Television (mine is an Insignia)</li>
</ul>

<h3>How it works</h3>

<p>The signal between a remote control handset and the device it controls consists of pulses of infrared light. The Spark Core, wired up with an IR led, simply mimics these pulses to control the television. Thanks to the wireless capabilities of the Spark Core, commands can easily be sent from any Internet connected device, in my case an iPhone.</p>

<h3>Finding your TV&#39;s control codes</h3>

<p>Different manufacturers of infrared remote controls use different protocols to transmit the infrared commands. Thankfully, most televisions protocols and codes have been mapped by the <a href="http://www.lirc.org/">Linux Infrared Remote Control</a> project. </p>

<p>Although, my Insignia television had the protocol and basic functions mapped, it was missing several key commands. A little light reading on the protocol (<a href="http://www.circuitvalley.com/2013/09/nec-protocol-ir-infrared-remote-control.html">NEC</a>) enabled me to write the following script. </p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">intToBinaryString</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
  <span class="n">binaryString</span> <span class="o">=</span> <span class="s">&quot;{0:b}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
  <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">binaryString</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">:</span>
    <span class="n">binaryString</span> <span class="o">=</span> <span class="s">&quot;0&quot;</span> <span class="o">+</span> <span class="n">binaryString</span>
  <span class="k">return</span> <span class="n">binaryString</span>


<span class="k">def</span> <span class="nf">complementBinaryString</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
  <span class="n">complement</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
  <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="n">string</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">bit</span> <span class="o">==</span> <span class="s">&quot;0&quot;</span><span class="p">:</span>
      <span class="n">complement</span> <span class="o">+=</span> <span class="s">&quot;1&quot;</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">complement</span> <span class="o">+=</span> <span class="s">&quot;0&quot;</span>
  <span class="k">return</span> <span class="n">complement</span>

<span class="k">def</span> <span class="nf">binaryStringToHex</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
  <span class="k">return</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">hexToBinary</span><span class="p">(</span><span class="n">hexval</span><span class="p">):</span>
        <span class="n">thelen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hexval</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span>
        <span class="n">binval</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">hexval</span><span class="p">,</span> <span class="mi">16</span><span class="p">))[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="k">while</span> <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">binval</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">thelen</span><span class="p">):</span>
            <span class="n">binval</span> <span class="o">=</span> <span class="s">&#39;0&#39;</span> <span class="o">+</span> <span class="n">binval</span>
        <span class="k">return</span> <span class="n">binval</span>

<span class="k">def</span> <span class="nf">funcToHexString</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; Returns the corresponding hex code for provided function number&quot;&quot;&quot;</span>
  <span class="n">prefix</span> <span class="o">=</span> <span class="n">intToBinaryString</span><span class="p">(</span><span class="n">num</span><span class="p">,</span><span class="mi">8</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">suffix</span> <span class="o">=</span> <span class="n">complementBinaryString</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">binaryStringToHex</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">hexStringToFunc</span><span class="p">(</span><span class="n">hexString</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; Returns the corresponding function number for provided hex code&quot;&quot;&quot;</span>
  <span class="n">binaryString</span> <span class="o">=</span> <span class="n">hexToBinary</span><span class="p">(</span><span class="n">hexString</span><span class="p">)</span>
  <span class="n">funcString</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
  <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
    <span class="n">funcString</span> <span class="o">+=</span> <span class="n">binaryString</span><span class="p">[</span><span class="n">num</span><span class="p">]</span>
  <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">funcString</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span>

<span class="n">funcCodes</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;18E7&quot;</span><span class="p">,</span> <span class="s">&quot;F00F&quot;</span><span class="p">,</span> <span class="s">&quot;00FF&quot;</span><span class="p">,</span> <span class="s">&quot;807F&quot;</span><span class="p">,</span> <span class="s">&quot;40BF&quot;</span><span class="p">,</span> <span class="s">&quot;C03F&quot;</span><span class="p">,</span> <span class="s">&quot;A05F&quot;</span><span class="p">,</span> <span class="s">&quot;20DF&quot;</span><span class="p">,</span> <span class="s">&quot;609F&quot;</span><span class="p">,</span> <span class="s">&quot;E01F&quot;</span><span class="p">,</span> <span class="s">&quot;10EF&quot;</span><span class="p">,</span> <span class="s">&quot;906F&quot;</span><span class="p">,</span> <span class="s">&quot;E817&quot;</span><span class="p">,</span> <span class="s">&quot;08F7&quot;</span><span class="p">,</span> <span class="s">&quot;708F&quot;</span><span class="p">,</span> <span class="s">&quot;B04F&quot;</span><span class="p">,</span> <span class="s">&quot;50AF&quot;</span><span class="p">,</span> <span class="s">&quot;30CF&quot;</span><span class="p">,</span> <span class="s">&quot;D02F&quot;</span><span class="p">,</span> <span class="s">&quot;28D7&quot;</span><span class="p">,</span> <span class="s">&quot;D827&quot;</span><span class="p">,</span> <span class="s">&quot;9867&quot;</span><span class="p">,</span> <span class="s">&quot;48B7&quot;</span><span class="p">,</span> <span class="s">&quot;8877&quot;</span><span class="p">,</span> <span class="s">&quot;38C7&quot;</span><span class="p">,</span><span class="s">&quot;C837&quot;</span><span class="p">]</span>
<span class="n">funcNums</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">funcCodes</span><span class="p">:</span>
  <span class="n">funcNums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hexStringToFunc</span><span class="p">(</span><span class="n">code</span><span class="p">))</span>
<span class="n">funcNums</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Function codes already decoded:&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">funcNums</span><span class="p">)</span>

<span class="n">codesToTest</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">30</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">num</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">funcNums</span><span class="p">:</span>
    <span class="n">codesToTest</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">funcToHexString</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Function codes to test:&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">codesToTest</span><span class="p">)</span></code></pre></div>

<p>Essentially the script determines which hex codes are missing from an NEC mapping. Instructing the Spark Core to execute a given infrared command and watching the TV&#39;s response allowed me to complete the mapping.</p>

<h3>Device and App</h3>

<p><img src="/public/images/remote-1.JPG" alt="remote close up">
<img src="/public/images/remote-2.JPG" alt="remote and tv">
<img src="/public/images/remote-3.PNG" alt="app"></p>

<h3>Code</h3>

<p>The code is available on GitHub <a href="https://github.com/grouma/TVRemote">here</a>. I&#39;m not an iOS developer so I thought it would be fun to learn Swift as well. Apologies in advanced for any poor practices. Also a special thanks to Gaspard van Koningsveld as I made use of his <a href="https://github.com/qwertzguy/Spark-Core-IRremote">Spark Core IR Library</a>.</p>

<h3>What&#39;s Next</h3>

<p>Both my bedroom and living room televisions are from the same manufacture and consequently use the same protocol and commands. I have built in the functionality to switch between Spark Cores. It would also be useful to switch between remote protocols and codes. Finally, I plan on using this project as an excuse to get a 3d printer. This will enable me to create an eye pleasing enclosure. </p>

</div>

        
 <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'grouma'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

      </div>

    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
